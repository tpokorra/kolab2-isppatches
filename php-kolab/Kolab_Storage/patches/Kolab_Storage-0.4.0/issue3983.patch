From: Gunnar Wrobel <wrobel@pardus.de>
Subject: [PATCH] issue3983.patch

Fixes unit testing for PHP 5.3.* and the new namespace handler.

STATUS: UNMERGED

REF: http://issues.kolab.org/issue3983

Signed-off-by: Gunnar Wrobel <wrobel@pardus.de>

diff -Naur --exclude='*~' a/framework/Kolab_Storage/test.orig/Horde/Kolab/Storage/AllTests.php a/framework/Kolab_Storage/test/Horde/Kolab/Storage/AllTests.php
--- a/framework/Kolab_Storage/test/Horde/Kolab/Storage/AllTests.php	2010-03-25 13:56:26.000000000 +0100
+++ b/framework/Kolab_Storage/test/Horde/Kolab/Storage/AllTests.php	2010-03-25 14:25:55.000000000 +0100
@@ -24,6 +24,8 @@
 require_once 'PHPUnit/Framework/TestSuite.php';
 require_once 'PHPUnit/TextUI/TestRunner.php';
 
+require_once 'Horde/Prefs.php';
+
 /**
  * Combine the tests for this package.
  *
diff -Naur --exclude='*~' a/framework/Kolab_Storage/test/Horde/Kolab/Storage/DataTest.php a/framework/Kolab_Storage/test/Horde/Kolab/Storage/DataTest.php
--- a/framework/Kolab_Storage/test/Horde/Kolab/Storage/DataTest.php	2010-03-25 13:56:26.000000000 +0100
+++ b/framework/Kolab_Storage/test/Horde/Kolab/Storage/DataTest.php	2010-03-25 14:38:59.000000000 +0100
@@ -78,8 +78,11 @@
      */
     public function testDelete()
     {
+        $list = &new Kolab_List();
+
         $data = &new Kolab_Data('contact');
         $folder = &new Kolab_Folder('INBOX/Contacts');
+        $folder->setList($list);
         $data->setFolder($folder);
 
         /** 
@@ -204,8 +207,11 @@
      */
     public function testSave()
     {
+        $list = &new Kolab_List();
+
         $data = &new Kolab_Data('contact');
         $folder = &new Kolab_Folder('INBOX/Contacts');
+        $folder->setList($list);
         $data->setFolder($folder);
         /** 
          * During testing we want to ensure that we do not access any
@@ -279,8 +285,11 @@
      */
     public function testObjectDeleteAll()
     {
+        $list = &new Kolab_List();
+
         $data = &new Kolab_Data('contact');
         $folder = &new Kolab_Folder('INBOX/Contacts');
+        $folder->setList($list);
         $data->setFolder($folder);
         /** 
          * During testing we want to ensure that we do not access any
diff -Naur --exclude='*~' a/framework/Kolab_Storage/test/Horde/Kolab/Storage/FolderTest.php a/framework/Kolab_Storage/test/Horde/Kolab/Storage/FolderTest.php
--- a/framework/Kolab_Storage/test/Horde/Kolab/Storage/FolderTest.php	2010-03-25 13:56:26.000000000 +0100
+++ b/framework/Kolab_Storage/test/Horde/Kolab/Storage/FolderTest.php	2010-03-25 14:39:35.000000000 +0100
@@ -68,6 +68,7 @@
     public function testSetName()
     {
         $folder = &new Kolab_Folder('INBOX/Contacts');
+        $folder->setList($this->list);
         $folder->setName('TestAÖÜ');
         $this->assertEquals(String::convertCharset('INBOX/TestAÖÜ', NLS::getCharset(), 'UTF7-IMAP'), $folder->new_name);
     }
diff -Naur --exclude='*~' a/framework/Kolab_Storage/test/Horde/Kolab/Storage/ListTest.php a/framework/Kolab_Storage/test/Horde/Kolab/Storage/ListTest.php
--- a/framework/Kolab_Storage/test/Horde/Kolab/Storage/ListTest.php	2010-03-25 13:56:26.000000000 +0100
+++ b/framework/Kolab_Storage/test/Horde/Kolab/Storage/ListTest.php	2010-03-25 14:36:33.000000000 +0100
@@ -225,8 +225,8 @@
         $default = $this->list->getDefault('event');
         $this->assertTrue(empty($default));
         $addfolder = &new Kolab_Folder(null);
-        $addfolder->setName('TestFolder');
         $addfolder->setList($this->list);
+        $addfolder->setName('TestFolder');
         $addfolder->save(array('type' => 'event', 'default' => true));
         $this->assertContains('INBOX/TestFolder', array_keys($this->list->_folders));
         $this->assertEquals('test@example.org', $addfolder->getOwner());
