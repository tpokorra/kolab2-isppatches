Index: php.spec
===================================================================
RCS file: /v/openpkg/cvs/openpkg-src/php/php.spec,v
retrieving revision 1.183
diff -u -B -r1.183 php.spec
--- php.spec	11 May 2008 08:31:26 -0000	1.183
+++ php.spec	13 May 2008 14:58:33 -0000
@@ -22,7 +22,7 @@
 ##
 
 #   package versions
-%define       V_php                     5.3.1
+%define       V_php                     5.3.2
 %define       V_php_suhosin_p           5.3.1-0.9.8
 %define       V_php_suhosin_e           0.9.29
 %define       V_php_kolab               5.2.8
@@ -39,7 +39,7 @@
 Group:        Language
 License:      PHP
 Version:      %{V_php}
-Release:      20091129
+Release:      20091129_kolab3
 
 #   package options
 %option       with_suhosin              no
@@ -61,6 +61,8 @@
 %option       with_iconv                no
 %option       with_imap                 no
 %option       with_imap_annotate        no
+%option       with_hash                 no
+%option       with_imap_myrights        no
 %option       with_json                 no
 %option       with_mbregex              no
 %option       with_mbstring             no
@@ -138,6 +140,7 @@
 Patch0:       http://download.suhosin.org/suhosin-patch-%{V_php_suhosin_p}.patch.gz
-Patch1:       http://kolab.org/cgi-bin/viewcvs-kolab.cgi/*checkout*/server/patches/php/php-%{V_php_kolab}/KOLAB_php-%{V_php_kolab}_Annotations.patch
+Patch1:       http://kolab.org/cgi-bin/viewcvs-kolab.cgi/*checkout*/server/patches/php/php-%{V_php_kolab}/KOLAB_php-%{V_php}_Annotations.patch
 Patch2:       php.patch
+Patch3:       http://kolab.org/cgi-bin/viewcvs-kolab.cgi/*checkout*/server/patches/php/php-%{V_php_kolab}/KOLAB_php-%{V_php}_myrights.patch
 
 #   build information
 Prefix:       %{l_prefix}
@@ -336,7 +338,10 @@
         configure \
         ext/gd/config.m4
 %if "%{with_imap_annotate}" == "yes"
-    sed <%{PATCH1} -e '/php-5.2.1\/ext\/imap\/php_imap.c.orig/,/^[^\+]/d' | %{l_patch} -p1
+    %patch -p1 -P 1
+%endif
+%if "%{with_imap_myrights}" == "yes"
+    %patch -p1 -P 3
 %endif
 
 %build
@@ -396,11 +396,15 @@
 %if "%{with_calendar}" == "yes"
         --enable-calendar \
 %endif
+ %if "%{with_hash}" == "yes"
+         --enable-hash \
+ %endif
-        --without-sqlite \
+        --with-pdo-sqlite=%{l_prefix} \
 %if "%{with_sqlite}" == "yes"
-        --with-pdo-sqlite=%{l_prefix} \
+        --with-sqlite=%{l_prefix} \
+        --with-sqlite3=%{l_prefix} \
 %else
-        --without-pdo-sqlite \
+        --without-sqlite \
 %endif
 %if "%{with_mysql}" == "yes"
         --with-mysql=%{l_prefix} \
--- php.ini.orig	2010-02-16 08:53:09.000000000 +0100
+++ php.ini	2010-02-16 08:53:23.000000000 +0100
@@ -6,17 +6,14 @@
 
 ;   Resource Limits
 register_globals   = off    ; Global variables are no longer registered for input data
-safe_mode          = on     ; Enable Safe Mode (file UID comparisons)
-safe_mode_gid      = off    ; Whether to relax Safe Mode to file GID comparisons
 allow_url_fopen    = off    ; Disable the opening of remote URLs
 display_errors     = off    ; Errors will NOT be displayed
 log_errors         = on     ; Errors will be logged
 max_execution_time = 60     ; Maximum execution time of each script, in seconds
 max_input_time     = 60     ; Maximum amount of time each script may spend parsing request data
-memory_limit       = 8M     ; Maximum amount of memory a script may consume
-post_max_size      = 8M     ; Maximum amount of POST data accepted
+memory_limit       = 128M   ; Maximum amount of memory a script may consume
+post_max_size      = 128M   ; Maximum amount of POST data accepted
 
 ;   Include Paths
 include_path          = ".:@l_prefix@/lib/php"
-safe_mode_include_dir = "@l_prefix@/lib/php"
 
